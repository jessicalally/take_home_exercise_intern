<!DOCTYPE HTML>
<html>
<head>
  <title>Quoting Engine</title>
</head>
<body>
<form id="form">
  <p>Quoting Engine</p>

  <div>
    <label for="pickupPostcode">Pickup postcode:</label>
    <input name="pickupPostcode" id="pickupPostcode">
  </div>

  <div>
    <label for="deliveryPostcode">Delivery postcode:</label>
    <input name="deliveryPostcode" id="deliveryPostcode">
  </div>

  <div>
    <label for="vehicle">Vehicle:</label>
    <select id = "vehicle" name = "vehicle">
      <option value = "NONE">None</option>
      <option value = "BICYCLE">Bicycle</option>
      <option value = "MOTORBIKE">Motorbike</option>
      <option value = "PARCEL_CAR">Parcel Car</option>
      <option value = "SMALL_VAN">Small Van</option>
      <option value = "LARGE_VAN">Large Van</option>
    </select>
  </div>

  <div>
    <button>Submit</button>
  </div>
</form>
  <p id="quote"></p>
</body>

<script>
  function handleSubmit(event) {
      event.preventDefault();
      const data = new FormData(event.target);
      const json = JSON.stringify(Object.fromEntries(data));
      const request = new XMLHttpRequest();
      request.open("POST", "/quote");
      request.responseType = "json";
      request.setRequestHeader("Content-Type", "application/json");
      let elem = document.getElementById("quote");
      request.onload = function() {
          if (request.status === 200) {
              const response = request.response;
              elem.innerText = `A delivery from ${response.pickupPostcode} to ${response.deliveryPostcode} using a ${response.vehicle.toLowerCase()} will cost you Â£${response.price}.`
          } else {
              console.error(request.statusText);
          }
      }
      elem.innerText = "Please wait...";
      request.send(json);
  }

  const form = document.querySelector('form');
  form.addEventListener('submit', handleSubmit);
</script>
</html>